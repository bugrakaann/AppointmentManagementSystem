@using Models.Enums
@model Models.ViewModel.SubmissionsViewModel
@{
    ViewData["Title"] = "Randevu Talepleri";

    string statusIcon;
    switch (Model.AppointmentStatus)
    {
        case AppointmentStatus.WaitingForApproval:
            statusIcon = "https://cdn-icons-png.flaticon.com/512/1827/1827336.png";
            break;
        case AppointmentStatus.Approved:
            statusIcon = "https://cdn-icons-png.flaticon.com/256/9826/9826449.png";
            break;
        default:
            statusIcon = "https://cdn0.iconfinder.com/data/icons/expenses-vs-income/30/__pending_transaction_clock_wait-512.png";
            break;
    }
}

<!-- Main Wrapper -->
<div class="main-wrapper">

    <!-- Breadcrumb -->
    <div class="breadcrumb-bar">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-12 col-12">
                    <h2 class="breadcrumb-title">Randevu Talepleri</h2>
                </div>
            </div>
        </div>
    </div>
    <!-- /Breadcrumb -->
    <!-- Page Content -->
    <div class="content">
        <div class="container">

            <div class="row">
                <div class="col-md-5 col-lg-4 col-xl-3 theiaStickySidebar">

                    <!-- Sidebar -->
                    <div class="profile-sidebar">
                        <div class="dashboard-widget">
                            <nav class="dashboard-menu">
                                <ul>
                                    <li class="@(Model.AppointmentStatus == AppointmentStatus.WaitingForApproval ? "active" : "")">
                                        <a href="@Url.Action("Index", new { status = AppointmentStatus.WaitingForApproval, page = 1 })">
                                            <i class="fas fa-hourglass-start"></i>
                                            <span>Bekleyen</span>
                                        </a>
                                    </li>
                                    <li class="@(Model.AppointmentStatus == AppointmentStatus.Approved ? "active" : "")">
                                        <a href="@Url.Action("Index", new { status = AppointmentStatus.Approved, page = 1 })">
                                            <i class="fas fa-calendar-check"></i>
                                            <span>Onaylý</span>
                                        </a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                    <!--  Sidebar -->

                </div>

                <div class="col-md-7 col-lg-8 col-xl-9">
                    <div class="appointments">
                        @if (!Model.PagedResult.Items.Any())
                        {
                            <div>
                                <p>Herhangi bir randevu talebi bulunmuyor!</p>
                            </div>
                        }
                        else
                        {
                            foreach (var appointment in Model.PagedResult.Items)
                            {
                                <div class="appointment-list">
                                    <div class="profile-info-widget">
                                        <a href="#" class="booking-pro-img">
                                            <img src="@statusIcon" alt="User Image">
                                        </a>
                                        <div class="profile-det-info">
                                            <h3>
                                                <a href="#">@appointment.Customer?.name @appointment.Customer?.surname</a>
                                            </h3>
                                            <div class="customer-details">
                                                <h5><i class="far fa-clock"></i>@appointment.startTime - @appointment.endTime.TimeOfDay</h5>
                                                <h5>
                                                    <i class="fas fa-envelope"></i>@appointment.Customer?.email
                                                </h5>
                                                <h5 class="mb-0">
                                                    <i class="fas fa-phone"></i>@appointment.Customer?.phoneNumber
                                                </h5>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="appointment-action">
                                        <a href="#"
                                           class="btn btn-sm bg-info-light"
                                           data-bs-toggle="modal"
                                           data-bs-target="#appt_details"
                                           data-id="@appointment.Id"
                                           data-status="@appointment.status"
                                           data-description="@appointment.description"
                                           data-name="@appointment.Customer?.name"
                                           data-surname="@appointment.Customer?.surname"
                                           data-email="@appointment.Customer?.email"
                                           data-phone="@appointment.Customer?.phoneNumber"
                                           data-address="@appointment.Customer?.address"
                                           data-starttime="@appointment.startTime.ToString("dd MMM yyyy hh:mm tt")"
                                           data-endtime="@appointment.endTime.ToString("dd MMM yyyy hh:mm tt")">
                                            <i class="far fa-eye"></i> Detaylar
                                        </a>
                                        @if (appointment.status == AppointmentStatus.WaitingForApproval)
                                        {
                                            @if (appointment.endTime < DateTime.Now)
                                            {
                                                <button class="btn btn-sm bg-secondary" onclick="alert('Geçersiz Tarih')" style="cursor: not-allowed">Onayla</button>
                                            }
                                            else
                                            {
                                                <a href="@Url.Action("Approve", new { id = appointment.Id })"
                                                   class="btn btn-sm bg-success-light">
                                                    <i class="fas fa-check"></i> Onayla
                                                </a>
                                            }

                                            <a href="@Url.Action("Deny", new { id = appointment.Id })" class="btn btn-sm bg-danger-light">
                                                <i class="fas fa-times"></i> Reddet
                                            </a>
                                        }
                                    </div>
                                </div>
                            }
                        }
                    </div>
                    <!-- Pagination Controls -->
                    @if (Model.PagedResult.TotalPages > 1)
                    {
                        <nav aria-label="Page navigation">
                            <ul class="pagination justify-content-center">
                                <li class="page-item @(Model.PagedResult.PageNumber == 1 ? "disabled" : "")">
                                    <a class="page-link" href="@Url.Action("Index", new { status = Model.AppointmentStatus, page = Model.PagedResult.PageNumber - 1 })" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>

                                @for (int i = 1; i <= Model.PagedResult.TotalPages; i++)
                                {
                                    <li class="page-item @(Model.PagedResult.PageNumber == i ? "active" : "")">
                                        <a class="page-link" href="@Url.Action("Index", new { status = Model.AppointmentStatus, page = i })">@i</a>
                                    </li>
                                }

                                <li class="page-item @(Model.PagedResult.PageNumber == Model.PagedResult.TotalPages ? "disabled" : "")">
                                    <a class="page-link" href="@Url.Action("Index", new { status = Model.AppointmentStatus, page = Model.PagedResult.PageNumber + 1 })" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    }

                    <!-- /Pagination Controls -->
                </div>
            </div>

        </div>

    </div>
    <!-- /Page Content -->

</div>
<!-- /Main Wrapper -->

<!-- Appointment Details Modal -->
<div class="modal fade custom-modal" id="appt_details">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Randevu Detaylarý</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <strong>Randevu Zamaný:</strong> <span id="appt_time"></span>
                </div>
                <div class="mb-3">
                    <strong>Müþteri:</strong> <span id="customer_name"></span>
                </div>
                <div class="mb-3">
                    <strong>Email:</strong> <span id="customer_email"></span>
                </div>
                <div class="mb-3">
                    <strong>Telefon:</strong> <span id="customer_phone"></span>
                </div>
                <div class="mb-3">
                    <strong>Adres:</strong> <span id="customer_address"></span>
                </div>
                <div class="mb-3">
                    <strong>Açýklama:</strong> <span id="appt_description"></span>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- /Appointment Details Modal -->

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var apptDetailsModal = document.getElementById('appt_details');

            apptDetailsModal.addEventListener('show.bs.modal', function (event) {
                var button = event.relatedTarget;

                var appointmentDetails = {
                    description: button.getAttribute('data-description'),
                    name: button.getAttribute('data-name'),
                    surname: button.getAttribute('data-surname'),
                    email: button.getAttribute('data-email'),
                    phone: button.getAttribute('data-phone'),
                    address: button.getAttribute('data-address'),
                    startTime: button.getAttribute('data-starttime'),
                    endTime: button.getAttribute('data-endtime')
                };

                apptDetailsModal.querySelector('#customer_name').textContent = `${appointmentDetails.name} ${appointmentDetails.surname}`;
                apptDetailsModal.querySelector('#customer_email').textContent = appointmentDetails.email;
                apptDetailsModal.querySelector('#customer_phone').textContent = appointmentDetails.phone;
                apptDetailsModal.querySelector('#customer_address').textContent = appointmentDetails.address;
                apptDetailsModal.querySelector('#appt_time').textContent = `${appointmentDetails.startTime} - ${appointmentDetails.endTime}`;
                apptDetailsModal.querySelector('#appt_description').textContent = appointmentDetails.description;
            });
        });
    </script>
}